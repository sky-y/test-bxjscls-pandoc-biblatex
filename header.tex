\usepackage{luatexja}

% フォント設定
% LuaTeX-jaのプリセット設定（Source Han Sans）を利用する
\usepackage[match, deluxe, export, bold, sourcehan]{luatexja-preset}
\setmainfont[Ligatures=TeX,Scale=1.02]{TeXGyreTermes}
\setsansfont[Ligatures=TeX,Scale=1.02]{TeXGyreHeros}

\usepackage{bxjaprnind}  % 段落先頭の括弧を修正
\setlength{\parindent}{1\zw}  % 段落 1段下げ

% Pandoc's Mardownの引用(> )をquotationに割り当て、ゴシック体にする
\renewenvironment{quote}{\begin{quotation}\sffamily\gtfamily}{\end{quotation}}

% \textbfの欧文フォントをサンセリフにする
\renewcommand{\textbf}[1]{{\bfseries\sffamily\gtfamily#1}}

% その他パッケージ
\usepackage{pxrubrica}
\usepackage{metalogo}
\usepackage{array, booktabs}
\usepackage{graphicx}

% 囲い (tcolorbox)
\usepackage{tcolorbox}
\tcbuselibrary{xparse}
\tcbuselibrary{skins}
\tcbuselibrary{breakable}
\newtcolorbox{titlebox}[1]{%
    breakable,
    enhanced,
    title=#1,
    fonttitle=\bfseries,
    parbox=false,
    attach boxed title to top left={xshift=3mm, yshift*=-\tcboxedtitleheight/2},
}
\newtcolorbox{episode}{%
    breakable,
    enhanced,
    title=エピソード,
    fonttitle=\bfseries,
    parbox=false,
    attach boxed title to top left={xshift=3mm, yshift*=-\tcboxedtitleheight/2},
}
\newtcolorbox{column}{%
    breakable,
    enhanced,
    title=コラム,
    fonttitle=\bfseries,
    parbox=false,
    attach boxed title to top left={xshift=3mm, yshift*=-\tcboxedtitleheight/2},
}

% ソースコード (listings)
\lstset{%
    basicstyle=\small\ttfamily,
    keywordstyle=\bfseries,
    commentstyle=\itshape,
    columns=fullflexible,
    numbers=none,
    stepnumber=1,
    backgroundcolor=\color[gray]{.90},
    xleftmargin=5mm,
    xrightmargin=5mm,
    belowskip=5mm,
    aboveskip=5mm,
    frame=lr,
    framesep=8pt,
    framerule=0pt,
    rulecolor=\color[gray]{1},
    breaklines=true,
    breakautoindent=true,
    breakatwhitespace=true,
    breakindent=25pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
    captionpos=b,
    linewidth=\textwidth,
}

% listingsで英単語区切り以外でも折り返し(wrap)するように強制
% https://qiita.com/takahashim/items/2234c7881fc84f7b5139
\makeatletter
\def\lst@lettertrue{\let\lst@ifletter\iffalse}
\makeatother

% pandoc-latex-unlistedのバグ用workaround
% https://github.com/chdemko/pandoc-latex-unlisted/issues/1
\let\oldaddcontentsline\addcontentsline
